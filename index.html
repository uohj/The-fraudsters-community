<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ù†ØªØ¯Ù‰ Ø§Ù„ÙØ±Ø§ÙˆØ¯Ø² | Ø§Ù„Ø±Ø³Ù…ÙŠ</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

    <style>
        :root { --accent: #ff0000; --bg: #0a0a0a; --card: #161616; --text: #e0e0e0; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); color: var(--text); margin: 0; display: flex; justify-content: center; align-items: center; height: 100vh; }
        
        .container { width: 95%; max-width: 500px; background: var(--card); padding: 25px; border-radius: 25px; border: 1px solid #333; box-shadow: 0 0 30px rgba(255,0,0,0.1); }
        header { text-align: center; margin-bottom: 20px; }
        .logo { width: 90px; height: 90px; border-radius: 50%; border: 2px solid var(--accent); padding: 3px; object-fit: cover; }
        h2 { margin: 10px 0; color: var(--accent); letter-spacing: 1px; }

        #chat-box { height: 380px; overflow-y: auto; display: flex; flex-direction: column; gap: 12px; padding: 15px; background: #00000050; border-radius: 15px; border: 1px solid #222; margin-bottom: 15px; }
        .msg { padding: 10px 14px; border-radius: 12px; font-size: 14px; position: relative; max-width: 80%; animation: fadeIn 0.3s; }
        .msg.admin { border-left: 3px solid var(--accent); background: #3d0000; align-self: center; text-align: center; width: 85%; }
        .msg.user { background: #222; align-self: flex-start; }
        .msg-info { display: block; font-weight: bold; font-size: 10px; color: var(--accent); margin-bottom: 3px; }

        input { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #333; border-radius: 10px; background: #111; color: #fff; box-sizing: border-box; }
        button { width: 100%; padding: 12px; background: var(--accent); color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; margin-top: 5px; }
        
        .admin-panel { background: #1a0000; padding: 15px; border-radius: 15px; border: 1px solid var(--accent); margin-top: 15px; display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .hidden { display: none !important; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div class="container">
    <header>
        <img src="https://i.imgur.com/d3DZ1Zk.jpeg" class="logo" alt="Logo">
        <h2>Ù…Ù†ØªØ¯Ù‰ Ø§Ù„ÙØ±Ø§ÙˆØ¯Ø²</h2>
    </header>

    <div id="auth-area">
        <input type="text" id="username" placeholder="Ø§Ù„ÙŠÙˆØ²Ø±">
        <input type="password" id="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±">
        <button onclick="handleAuth()">Ø¯Ø®ÙˆÙ„ / ØªØ³Ø¬ÙŠÙ„</button>
    </div>

    <div id="chat-area" class="hidden">
        <div id="chat-box"></div>
        <div id="input-controls">
            <input type="text" id="msg-input" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ..." onkeypress="if(event.key==='Enter') sendMessage()">
            <button onclick="sendMessage()">Ø¥Ø±Ø³Ø§Ù„ ğŸš€</button>
        </div>
        
        <div id="admin-tools" class="admin-panel hidden">
            <button onclick="toggleChat()" id="lock-btn" style="background:#444">Ù‚ÙÙ„ Ø§Ù„Ø´Ø§Øª</button>
            <button onclick="clearAllMessages()" style="background:#800">Ø­Ø°Ù Ø§Ù„Ø´Ø§Øª ğŸ—‘ï¸</button>
            <input type="text" id="target-user" placeholder="Ø§Ø³Ù… Ø§Ù„ÙŠÙˆØ²Ø±" style="grid-column: span 2; margin:0">
            <button onclick="promoteUser()" style="background:#1b5e20">ØªØ±Ù‚ÙŠØ© (Ø£Ø¯Ù…Ù†)</button>
            <button onclick="demoteUser()" style="background:#333">Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø±ØªØ¨Ø©</button>
        </div>
        <button onclick="location.reload()" style="background:transparent; color:#666; font-size:12px; margin-top:10px;">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
    </div>
</div>

<audio id="msg-sound" src="https://assets.mixkit.co/active_storage/sfx/2354/2354-preview.mp3"></audio>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyCuJVNiwNN4t-2pbbek4ncWdU_szocC7cY",
        authDomain: "uohj77.firebaseapp.com",
        projectId: "uohj77",
        databaseURL: "https://uohj77-default-rtdb.firebaseio.com/",
        storageBucket: "uohj77.firebasestorage.app",
        messagingSenderId: "263490547266",
        appId: "1:263490547266:web:a9b75b370a1e8d7910c7db"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    let myUser = null, myRole = 'user', sound = document.getElementById('msg-sound');

    function handleAuth() {
        const user = document.getElementById('username').value.trim();
        const pass = document.getElementById('password').value.trim();
        if(!user || !pass) return;

        db.ref('users/' + user).once('value', (snap) => {
            const data = snap.val();
            if (data) {
                if (data.password === pass) loginSuccess(user, data.role);
                else alert("Ø®Ø·Ø£ ÙÙŠ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±");
            } else {
                const role = (user === 'uohj') ? 'admin' : 'user';
                db.ref('users/' + user).set({ password: pass, role: role });
                loginSuccess(user, role);
            }
        });
    }

    function loginSuccess(user, role) {
        myUser = user; myRole = role;
        document.getElementById('auth-area').classList.add('hidden');
        document.getElementById('chat-area').classList.remove('hidden');
        if(role === 'admin') document.getElementById('admin-tools').classList.remove('hidden');
        listenChat(); listenSettings();
    }

    function sendMessage() {
        const input = document.getElementById('msg-input');
        if(!input.value.trim()) return;
        db.ref('settings/locked').once('value', (snap) => {
            if(snap.val() && myRole !== 'admin') return alert("Ø§Ù„Ø´Ø§Øª Ù…Ù‚ÙÙ„");
            db.ref('messages').push({ user: myUser, text: input.value, role: myRole });
            input.value = "";
        });
    }

    function listenChat() {
        db.ref('messages').limitToLast(50).on('value', (snap) => {
            const box = document.getElementById('chat-box');
            box.innerHTML = "";
            snap.forEach((child) => {
                const m = child.val();
                const div = document.createElement('div');
                div.className = `msg ${m.role === 'admin' ? 'admin' : 'user'}`;
                div.innerHTML = `<span class="msg-info">${m.role==='admin'?'[Ø£Ø¯Ù…Ù†] ':''}${m.user}</span>${m.text}`;
                box.appendChild(div);
            });
            box.scrollTop = box.scrollHeight;
            sound.play(); // ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª Ø¹Ù†Ø¯ ÙƒÙ„ Ø±Ø³Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©
        });
    }

    function listenSettings() {
        db.ref('settings/locked').on('value', (snap) => {
            const locked = snap.val();
            document.getElementById('lock-btn').innerText = locked ? "ÙØªØ­ Ø§Ù„Ø´Ø§Øª" : "Ù‚ÙÙ„ Ø§Ù„Ø´Ø§Øª";
        });
    }

    // ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
    function toggleChat() {
        db.ref('settings/locked').once('value', (snap) => {
            db.ref('settings').update({ locked: !snap.val() });
        });
    }

    function clearAllMessages() {
        if(confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ÙØ¹Ù„ÙŠØ§Ù‹ØŸ")) {
            db.ref('messages').remove();
        }
    }

    function promoteUser() {
        const target = document.getElementById('target-user').value.trim();
        if(target) {
            db.ref('users/' + target).update({ role: 'admin' });
            alert("ØªÙ…Øª ØªØ±Ù‚ÙŠØ© " + target + " Ù„Ø£Ø¯Ù…Ù†");
        }
    }

    function demoteUser() {
        const target = document.getElementById('target-user').value.trim();
        if(target) {
            db.ref('users/' + target).update({ role: 'user' });
            alert("ØªÙ… Ø³Ø­Ø¨ Ø§Ù„Ø±ØªØ¨Ø© Ù…Ù† " + target);
        }
    }
</script>
</body>
</html>
