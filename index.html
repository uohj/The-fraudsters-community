<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>منتدى الفراودز</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

    <style>
        :root { --main: #1a1a1a; --accent: #d32f2f; --bg: #0f0f0f; --text: #ffffff; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); color: var(--text); margin: 0; display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; }
        .container { width: 95%; max-width: 450px; background: #1e1e1e; padding: 25px; border-radius: 20px; box-shadow: 0 0 20px rgba(0,0,0,0.5); border: 1px solid #333; }
        
        header { text-align: center; margin-bottom: 20px; }
        .logo { width: 100px; height: 100px; border-radius: 50%; border: 2px solid var(--accent); object-fit: cover; box-shadow: 0 0 15px var(--accent); }
        h2 { font-size: 1.5rem; margin-top: 10px; color: var(--accent); }

        #chat-box { height: 350px; border: 1px solid #333; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; padding: 15px; background: #141414; border-radius: 12px; margin-bottom: 15px; }
        .msg { padding: 10px 15px; border-radius: 12px; font-size: 14px; max-width: 85%; position: relative; word-wrap: break-word; }
        .msg.admin { border-right: 4px solid var(--accent); background: #2d1616; align-self: center; text-align: center; width: 90%; }
        .msg.user { background: #262626; align-self: flex-start; border: 1px solid #333; }
        .msg-info { display: block; font-weight: bold; font-size: 11px; margin-bottom: 4px; color: var(--accent); }

        input { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #444; border-radius: 8px; background: #222; color: white; box-sizing: border-box; }
        button { width: 100%; padding: 12px; background: var(--accent); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        button:hover { opacity: 0.8; }
        
        .hidden { display: none !important; }
        .admin-panel { background: #2d1616; padding: 10px; border-radius: 8px; margin-top: 10px; border: 1px solid var(--accent); }
    </style>
</head>
<body>

<div class="container">
    <header>
        <img src="https://i.imgur.com/d3DZ1Zk.jpeg" class="logo" alt="Logo">
        <h2>منتدى الفراودز</h2>
    </header>

    <div id="auth-area">
        <input type="text" id="username" placeholder="اسم المستخدم">
        <input type="password" id="password" placeholder="كلمة المرور">
        <button onclick="handleAuth()">دخول / إنشاء حساب</button>
    </div>

    <div id="chat-area" class="hidden">
        <div id="chat-box"></div>
        <div id="input-controls">
            <input type="text" id="msg-input" placeholder="اكتب شيئاً...">
            <button onclick="sendMessage()">إرسال</button>
        </div>
        
        <div id="admin-tools" class="admin-panel hidden">
            <button id="lock-btn" onclick="toggleChat()" style="background:#000;">قفل الشات</button>
            <input type="text" id="target-user" placeholder="اسم اليوزر للترقية" style="width: 65%;">
            <button onclick="promoteUser()" style="width: 30%; background: #444;">ترقية</button>
        </div>
        <button onclick="logout()" style="background:#333; margin-top:10px; height: 35px; padding: 0;">خروج</button>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyCuJVNiwNN4t-2pbbek4ncWdU_szocC7cY",
        authDomain: "uohj77.firebaseapp.com",
        projectId: "uohj77",
        databaseURL: "https://uohj77-default-rtdb.firebaseio.com/",
        storageBucket: "uohj77.firebasestorage.app",
        messagingSenderId: "263490547266",
        appId: "1:263490547266:web:a9b75b370a1e8d7910c7db"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    let myUser = null, myRole = 'user';

    function handleAuth() {
        const user = document.getElementById('username').value.trim();
        const pass = document.getElementById('password').value.trim();
        if(!user || !pass) return alert("أدخل بياناتك!");

        db.ref('users/' + user).once('value', (snap) => {
            const data = snap.val();
            if (data) {
                if (data.password === pass) loginSuccess(user, data.role);
                else alert("كلمة السر خطأ!");
            } else {
                const role = (user === 'uohj') ? 'admin' : 'user';
                db.ref('users/' + user).set({ password: pass, role: role });
                loginSuccess(user, role);
            }
        });
    }

    function loginSuccess(user, role) {
        myUser = user; myRole = role;
        document.getElementById('auth-area').classList.add('hidden');
        document.getElementById('chat-area').classList.remove('hidden');
        if(role === 'admin') document.getElementById('admin-tools').classList.remove('hidden');
        listenChat(); listenSettings();
    }

    function sendMessage() {
        const input = document.getElementById('msg-input');
        if(!input.value.trim()) return;
        db.ref('settings/locked').once('value', (snap) => {
            if(snap.val() && myRole !== 'admin') return alert("الشات مغلق!");
            db.ref('messages').push({ user: myUser, text: input.value, role: myRole });
            input.value = "";
        });
    }

    function listenChat() {
        db.ref('messages').limitToLast(50).on('value', (snap) => {
            const box = document.getElementById('chat-box');
            box.innerHTML = "";
            snap.forEach((child) => {
                const m = child.val();
                const div = document.createElement('div');
                div.className = `msg ${m.role === 'admin' ? 'admin' : 'user'}`;
                div.innerHTML = `<span class="msg-info">${m.role==='admin'?'[مدير] ':''}${m.user}</span>${m.text}`;
                box.appendChild(div);
            });
            box.scrollTop = box.scrollHeight;
        });
    }

    function listenSettings() {
        db.ref('settings/locked').on('value', (snap) => {
            const locked = snap.val();
            document.getElementById('lock-btn').innerText = locked ? "فتح الشات" : "قفل الشات";
            if(myRole !== 'admin') document.getElementById('input-controls').classList.toggle('hidden', locked);
        });
    }

    function toggleChat() {
        db.ref('settings/locked').once('value', (snap) => {
            db.ref('settings').update({ locked: !snap.val() });
        });
    }

    function promoteUser() {
        const target = document.getElementById('target-user').value.trim();
        if(target) {
            db.ref('users/' + target).update({ role: 'admin' });
            alert("تمت ترقية " + target);
        }
    }

    function logout() { location.reload(); }
</script>
</body>
</html>
