<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ù†ØªØ¯Ù‰ Ø³ÙˆØ§Ù„ÙŠÙ | Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</title>
    <style>
        /* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹ CSS */
        :root {
            --primary-color: #2563eb;
            --admin-red: #e11d48;
            --bg-color: #f8fafc;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
        }

        .main-container {
            width: 95%;
            max-width: 500px;
            background: white;
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        header { text-align: center; margin-bottom: 20px; }
        #logo { width: 100px; height: 100px; border-radius: 50%; object-fit: cover; border: 3px solid var(--primary-color); }

        .form-group { margin-bottom: 15px; }
        input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 10px;
            box-sizing: border-box;
            font-size: 16px;
        }

        button {
            width: 100%;
            padding: 12px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: 0.3s;
        }

        button:hover { opacity: 0.9; }

        .hidden { display: none !important; }

        /* Ø§Ù„Ø´Ø§Øª */
        #chat-window {
            height: 400px;
            border: 1px solid #eee;
            border-radius: 10px;
            overflow-y: auto;
            padding: 15px;
            background: #fff;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .msg {
            padding: 10px 15px;
            border-radius: 15px;
            max-width: 80%;
            position: relative;
            word-wrap: break-word;
        }

        .user-msg { background: #f1f5f9; align-self: flex-start; border-bottom-right-radius: 2px; }
        .admin-msg { background: #fee2e2; border: 1px solid var(--admin-red); align-self: flex-end; border-bottom-left-radius: 2px; }

        .msg-info { font-size: 11px; font-weight: bold; display: block; margin-bottom: 4px; }
        .badge { background: var(--admin-red); color: white; padding: 2px 6px; border-radius: 4px; font-size: 10px; margin-left: 5px; }

        .admin-panel {
            background: #fff1f1;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            border: 1px dashed var(--admin-red);
        }

        .lock-notice { color: var(--admin-red); text-align: center; font-weight: bold; margin-bottom: 10px; }
    </style>
</head>
<body>

<div class="main-container">
    <header>
        <img src="https://i.imgur.com/d3DZ1Zk.jpeg" id="logo" alt="Logo">
        <h2 id="view-title">Ù…Ù†ØªØ¯Ù‰ Ø³ÙˆØ§Ù„ÙŠÙ</h2>
    </header>

    <div id="auth-box">
        <div class="form-group">
            <input type="text" id="user-input" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
        </div>
        <div class="form-group">
            <input type="password" id="pass-input" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
        </div>
        <div style="display: flex; gap: 10px;">
            <button onclick="handleAuth('login')">ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„</button>
            <button onclick="handleAuth('signup')" style="background: #10b981;">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</button>
        </div>
    </div>

    <div id="chat-container" class="hidden">
        <div id="lock-msg" class="lock-notice hidden">ğŸ”’ Ø§Ù„Ø´Ø§Øª Ù…ØºÙ„Ù‚ Ø­Ø§Ù„ÙŠØ§Ù‹ Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</div>
        <div id="chat-window"></div>
        
        <div id="send-area" style="margin-top: 15px; display: flex; gap: 5px;">
            <input type="text" id="message-text" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ...">
            <button onclick="sendMessage()" style="width: 80px;">Ø¥Ø±Ø³Ø§Ù„</button>
        </div>

        <div id="admin-controls" class="admin-panel hidden">
            <p style="margin: 0 0 10px 0; color: var(--admin-red);">ğŸ›  Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© (uohj)</p>
            <button onclick="toggleChatLock()" id="lock-btn" style="background: #334155; margin-bottom: 10px;">Ù‚ÙÙ„ Ø§Ù„Ø´Ø§Øª</button>
            <div style="display: flex; gap: 5px;">
                <input type="text" id="target-user" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„Ù„ØªØ±Ù‚ÙŠØ©" style="font-size: 12px;">
                <button onclick="promote()" style="background: #059669; font-size: 12px; width: 120px;">Ø¥Ø¹Ø·Ø§Ø¡ Ø±ØªØ¨Ø©</button>
            </div>
        </div>

        <button onclick="location.reload()" style="background: #94a3b8; margin-top: 15px;">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
    </div>
</div>

<script>
    // Ø§Ù„Ù…Ù†Ø·Ù‚ Ø§Ù„Ø¨Ø±Ù…Ø¬ÙŠ JavaScript
    let currentUser = "";
    let userIsAdmin = false;

    // ÙˆØ¸ÙŠÙØ© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØ§Ù„Ø¥Ù†Ø´Ø§Ø¡
    function handleAuth(type) {
        const u = document.getElementById('user-input').value.trim();
        const p = document.getElementById('pass-input').value.trim();

        if (u === "" || p === "") return alert("ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");

        let users = JSON.parse(localStorage.getItem('forum_users') || '{}');

        if (type === 'signup') {
            if (users[u]) return alert("Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ø§Ù‹!");
            users[u] = btoa(p); // ØªØ´ÙÙŠØ± Ø¨Ø³ÙŠØ· Ø¨Ù€ Base64
            localStorage.setItem('forum_users', JSON.stringify(users));
            alert("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­! ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„.");
        } else {
            if (!users[u] || users[u] !== btoa(p)) return alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±!");
            
            currentUser = u;
            if (u === "uohj") userIsAdmin = true;
            startChat();
        }
    }

    function startChat() {
        document.getElementById('auth-box').classList.add('hidden');
        document.getElementById('chat-container').classList.remove('hidden');
        if (userIsAdmin) document.getElementById('admin-controls').classList.remove('hidden');
        updateChat();
    }

    function sendMessage() {
        const isLocked = localStorage.getItem('chat_locked') === 'true';
        if (isLocked && !userIsAdmin) return alert("Ø§Ù„Ø´Ø§Øª Ù…ØºÙ„Ù‚!");

        const text = document.getElementById('message-text').value.trim();
        if (!text) return;

        let msgs = JSON.parse(localStorage.getItem('forum_messages') || '[]');
        let isPromoted = localStorage.getItem('rank_' + currentUser) === 'admin';

        msgs.push({
            sender: currentUser,
            text: text,
            isAdmin: userIsAdmin || isPromoted
        });

        localStorage.setItem('forum_messages', JSON.stringify(msgs));
        document.getElementById('message-text').value = "";
        updateChat();
    }

    function updateChat() {
        const win = document.getElementById('chat-window');
        const msgs = JSON.parse(localStorage.getItem('forum_messages') || '[]');
        const isLocked = localStorage.getItem('chat_locked') === 'true';

        // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù‚ÙÙ„
        document.getElementById('lock-msg').classList.toggle('hidden', !isLocked);
        document.getElementById('send-area').classList.toggle('hidden', isLocked && !userIsAdmin);
        document.getElementById('lock-btn').innerText = isLocked ? "ÙØªØ­ Ø§Ù„Ø´Ø§Øª" : "Ù‚ÙÙ„ Ø§Ù„Ø´Ø§Øª";

        win.innerHTML = msgs.map(m => `
            <div class="msg ${m.isAdmin ? 'admin-msg' : 'user-msg'}">
                <span class="msg-info">
                    ${m.isAdmin ? '<span class="badge">Ø¥Ø¯Ø§Ø±Ø©</span>' : ''}
                    ${m.sender}
                </span>
                ${m.text}
            </div>
        `).join('');
        win.scrollTop = win.scrollHeight;
    }

    // ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø£Ø¯Ù…Ù† uohj
    function toggleChatLock() {
        const current = localStorage.getItem('chat_locked') === 'true';
        localStorage.setItem('chat_locked', !current);
        updateChat();
    }

    function promote() {
        const target = document.getElementById('target-user').value.trim();
        if (!target) return;
        localStorage.setItem('rank_' + target, 'admin');
        alert("ØªÙ…Øª ØªØ±Ù‚ÙŠØ© " + target + " Ø¥Ù„Ù‰ Ø±ØªØ¨Ø© Ø¥Ø¯Ø§Ø±Ø©");
        document.getElementById('target-user').value = "";
    }

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø´Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ ÙƒÙ„ Ø«Ø§Ù†ÙŠØ© Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯
    setInterval(updateChat, 1000);
</script>

</body>
</html>
